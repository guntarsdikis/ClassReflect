--- ./schema-comparison-20250929-104009/local-schema.sql	2025-09-29 10:40:11
+++ ./schema-comparison-20250929-104009/prod-schema.sql	2025-09-29 10:40:29
@@ -1,22 +1,19 @@
+  `ai_model` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'anthropic/claude-sonnet-4-20250514',
   `ai_model` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'gpt-4',
-  `ai_model` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'anthropic/claude-sonnet-4-20250514',
   `applied_by` int DEFAULT NULL,
   `applied_by` int DEFAULT NULL,
   `applied_by` int NOT NULL,
-  `assemblyai_transcript_id` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `assemblyai_upload_url` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `assemblyai_transcript_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `assemblyai_upload_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `category_id` int DEFAULT NULL,
-  `category_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `category` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `category` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'Custom',
-  `category` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT 'General',
-  `change_description` text COLLATE utf8mb4_unicode_ci,
-  `changed_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
-  `changed_by` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `category_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `category` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `category` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'Custom',
+  `category` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'General',
   `class_duration_minutes` int DEFAULT NULL,
-  `class_name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `cognito_username` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `color` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `class_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `cognito_username` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `color` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `completed_at` timestamp NULL DEFAULT NULL,
   `confidence_score` decimal(3,2) DEFAULT NULL,
   `confidence` decimal(5,4) NOT NULL,
@@ -36,39 +33,35 @@
   `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
   `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
   `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
-  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
   `created_by` int DEFAULT NULL,
   `created_by` int DEFAULT NULL,
   `created_by` int DEFAULT NULL,
   `created_by` int DEFAULT NULL,
-  `created_by` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
   `criteria_added` int DEFAULT '0',
   `criteria_description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
   `criteria_id` int DEFAULT NULL,
   `criteria_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `description` text COLLATE utf8mb4_unicode_ci,
-  `description` text COLLATE utf8mb4_unicode_ci,
-  `description` text COLLATE utf8mb4_unicode_ci,
-  `description` text COLLATE utf8mb4_unicode_ci,
-  `description` text COLLATE utf8mb4_unicode_ci,
+  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
+  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
+  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
+  `description` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
   `description` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `detailed_feedback` json DEFAULT NULL,
   `detailed_feedback` json DEFAULT NULL,
   `domain` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `duration_seconds` int DEFAULT NULL,
-  `email` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `email` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `end_time` decimal(10,3) NOT NULL,
   `error_message` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
-  `error_message` text COLLATE utf8mb4_unicode_ci,
+  `error_message` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
   `expires_at` timestamp NOT NULL,
   `expires_at` timestamp NULL DEFAULT NULL,
-  `external_id` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
-  `feedback` text COLLATE utf8mb4_unicode_ci,
+  `external_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `file_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `file_size` bigint DEFAULT NULL,
-  `first_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `first_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `grade_levels` json DEFAULT NULL,
-  `grade` varchar(10) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `grade` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `grades` json DEFAULT NULL,
   `id` int NOT NULL AUTO_INCREMENT,
   `id` int NOT NULL AUTO_INCREMENT,
@@ -83,14 +76,10 @@
   `id` int NOT NULL AUTO_INCREMENT,
   `id` int NOT NULL AUTO_INCREMENT,
   `id` int NOT NULL AUTO_INCREMENT,
-  `id` int NOT NULL AUTO_INCREMENT,
-  `id` int NOT NULL AUTO_INCREMENT,
-  `id` int NOT NULL AUTO_INCREMENT,
+  `id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT (uuid()),
   `id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `id` varchar(36) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT (uuid()),
   `improvements` json DEFAULT NULL,
   `improvements` json DEFAULT NULL,
-  `is_active` tinyint(1) DEFAULT '0',
   `is_active` tinyint(1) DEFAULT '1',
   `is_active` tinyint(1) DEFAULT '1',
   `is_active` tinyint(1) DEFAULT '1',
@@ -102,43 +91,31 @@
   `is_global` tinyint(1) DEFAULT '0',
   `job_id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `job_id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `job_id` varchar(36) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `job_id` varchar(36) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `job_id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `job_id` varchar(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `key_hash` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `key_prefix` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `key` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
   `language` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'en',
   `last_login` timestamp NULL DEFAULT NULL,
-  `last_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `last_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `last_used_at` timestamp NULL DEFAULT NULL,
-  `lemur_prompt_id` int DEFAULT NULL,
   `max_monthly_uploads` int DEFAULT '100',
   `max_teachers` int DEFAULT '10',
-  `metadata` json DEFAULT NULL,
-  `metadata` json DEFAULT NULL,
-  `name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
   `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
-  `notes` text COLLATE utf8mb4_unicode_ci,
-  `openai_prompt_id` int DEFAULT NULL,
+  `notes` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
   `order_index` int DEFAULT '0',
   `overall_score` decimal(5,2) DEFAULT NULL,
   `overall_score` decimal(5,2) DEFAULT NULL,
-  `password_hash` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `password_hash` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `permissions` json DEFAULT NULL,
   `processing_completed_at` timestamp NULL DEFAULT NULL,
   `processing_started_at` timestamp NULL DEFAULT NULL,
   `processing_time_seconds` int DEFAULT NULL,
   `progress_percent` int DEFAULT '0',
-  `prompt_id` int NOT NULL,
-  `prompt_id` int NOT NULL,
-  `prompt_template` longtext COLLATE utf8mb4_unicode_ci NOT NULL,
-  `prompt_template` longtext COLLATE utf8mb4_unicode_ci NOT NULL,
-  `provider` enum('lemur','openai') COLLATE utf8mb4_unicode_ci NOT NULL,
-  `provider` enum('lemur','openai') COLLATE utf8mb4_unicode_ci NOT NULL,
   `queued_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
-  `role` enum('teacher','school_manager','super_admin') COLLATE utf8mb4_unicode_ci NOT NULL,
-  `s3_key` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `role` enum('teacher','school_manager','super_admin') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `s3_key` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `school_id` int DEFAULT NULL,
   `school_id` int DEFAULT NULL,
   `school_id` int DEFAULT NULL,
@@ -149,16 +126,15 @@
   `school_id` int NOT NULL,
   `school_id` int NOT NULL,
   `school_id` int NOT NULL,
-  `score` decimal(5,2) DEFAULT NULL,
   `start_time` decimal(10,3) NOT NULL,
   `started_at` timestamp NULL DEFAULT NULL,
   `status` enum('pending','uploading','queued','processing','completed','failed') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'pending',
-  `status` enum('queued','processing','completed','failed') COLLATE utf8mb4_unicode_ci DEFAULT 'queued',
+  `status` enum('queued','processing','completed','failed') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT 'queued',
   `strengths` json DEFAULT NULL,
   `strengths` json DEFAULT NULL,
-  `subject_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `subject_name` varchar(100) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `subject` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
+  `subject_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `subject_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
+  `subject` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL,
   `subjects` json DEFAULT NULL,
   `subjects` json DEFAULT NULL,
   `subscription_expires` date DEFAULT NULL,
@@ -171,11 +147,7 @@
   `template_id` int NOT NULL,
   `template_id` int NOT NULL,
   `template_id` int NOT NULL,
-  `template_name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
-  `test_input` text COLLATE utf8mb4_unicode_ci,
-  `test_output` text COLLATE utf8mb4_unicode_ci,
-  `tested_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
-  `tested_by` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `template_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   `token` varchar(255) NOT NULL,
   `transcript_id` int NOT NULL,
   `transcript_id` int NOT NULL,
@@ -193,12 +165,10 @@
   `used` tinyint(1) DEFAULT '0',
   `user_id` int NOT NULL,
   `value` json NOT NULL,
-  `version` int NOT NULL DEFAULT '1',
-  `version` int NOT NULL,
   `weight` decimal(5,2) DEFAULT '1.00' COMMENT 'Weight as percentage (0.00-100.00), template total should equal 100.00',
   `word_count` int DEFAULT NULL,
   `word_index` int NOT NULL,
-  `word_text` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
+  `word_text` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
   1 AS `applied_by_first_name`,
   1 AS `applied_by_last_name`,
   1 AS `class_name`,
@@ -234,8 +204,6 @@
   CONSTRAINT `fk_transcripts_teacher_id` FOREIGN KEY (`teacher_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
   CONSTRAINT `fk_users_school_id` FOREIGN KEY (`school_id`) REFERENCES `schools` (`id`) ON DELETE CASCADE
   CONSTRAINT `password_reset_tokens_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
-  CONSTRAINT `prompt_history_ibfk_1` FOREIGN KEY (`prompt_id`) REFERENCES `prompts` (`id`) ON DELETE CASCADE
-  CONSTRAINT `prompt_test_results_ibfk_1` FOREIGN KEY (`prompt_id`) REFERENCES `prompts` (`id`) ON DELETE CASCADE
   CONSTRAINT `school_subjects_ibfk_1` FOREIGN KEY (`school_id`) REFERENCES `schools` (`id`) ON DELETE CASCADE,
   CONSTRAINT `school_subjects_ibfk_2` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`)
   CONSTRAINT `system_subjects_ibfk_1` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`)
@@ -268,7 +236,6 @@
   KEY `idx_applied_by` (`applied_by`),
   KEY `idx_category` (`category`),
   KEY `idx_category` (`category`),
-  KEY `idx_changed_at` (`changed_at`),
   KEY `idx_cognito_username` (`cognito_username`),
   KEY `idx_created_at` (`created_at`),
   KEY `idx_created_at` (`created_at`),
@@ -288,9 +255,6 @@
   KEY `idx_key_prefix` (`key_prefix`),
   KEY `idx_order` (`order_index`),
   KEY `idx_overall_score` (`overall_score`),
-  KEY `idx_prompt_id` (`prompt_id`),
-  KEY `idx_provider_active` (`provider`,`is_active`),
-  KEY `idx_provider_name_version` (`provider`,`name`,`version`)
   KEY `idx_role` (`role`),
   KEY `idx_school_id` (`school_id`),
   KEY `idx_school_id` (`school_id`),
@@ -319,7 +283,6 @@
   KEY `idx_transcript_id` (`transcript_id`),
   KEY `job_id` (`job_id`),
   KEY `job_id` (`job_id`),
-  KEY `prompt_id` (`prompt_id`),
   KEY `school_id` (`school_id`),
   KEY `school_id` (`school_id`),
   KEY `school_id` (`school_id`),
@@ -339,16 +302,12 @@
   PRIMARY KEY (`id`),
   PRIMARY KEY (`id`),
   PRIMARY KEY (`id`),
-  PRIMARY KEY (`id`),
-  PRIMARY KEY (`id`),
-  PRIMARY KEY (`id`),
   PRIMARY KEY (`key`)
   SQL SECURITY DEFINER
   UNIQUE KEY `email` (`email`),
   UNIQUE KEY `key_hash` (`key_hash`),
   UNIQUE KEY `subject_name` (`subject_name`),
   UNIQUE KEY `token` (`token`),
-  UNIQUE KEY `unique_provider_name_version` (`provider`,`name`,`version`),
   UNIQUE KEY `unique_school_subject` (`school_id`,`subject_name`),
   UNIQUE KEY `unique_template_category_per_school` (`school_id`,`category_name`),
  1 AS `id`,
@@ -373,9 +332,6 @@
  SET @saved_cs_client     = @@character_set_client ;
  SET @saved_cs_client     = @@character_set_client ;
  SET @saved_cs_client     = @@character_set_client ;
- SET @saved_cs_client     = @@character_set_client ;
- SET @saved_cs_client     = @@character_set_client ;
- SET @saved_cs_client     = @@character_set_client ;
  SET @saved_cs_results         = @@character_set_results ;
  SET character_set_client      = @saved_cs_client ;
  SET character_set_client      = utf8mb4 ;
@@ -395,9 +351,6 @@
  SET character_set_client = @saved_cs_client ;
  SET character_set_client = @saved_cs_client ;
  SET character_set_client = @saved_cs_client ;
- SET character_set_client = @saved_cs_client ;
- SET character_set_client = @saved_cs_client ;
- SET character_set_client = @saved_cs_client ;
  SET character_set_client = utf8mb4 ;
  SET character_set_client = utf8mb4 ;
  SET character_set_client = utf8mb4 ;
@@ -414,9 +367,6 @@
  SET character_set_client = utf8mb4 ;
  SET character_set_client = utf8mb4 ;
  SET character_set_client = utf8mb4 ;
- SET character_set_client = utf8mb4 ;
- SET character_set_client = utf8mb4 ;
- SET character_set_client = utf8mb4 ;
  SET character_set_results     = @saved_cs_results ;
  SET character_set_results     = utf8mb4 ;
  SET collation_connection      = @saved_col_connection ;
@@ -432,24 +382,18 @@
 ) ENGINE=InnoDB AUTO_INCREMENT=XXX DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB AUTO_INCREMENT=XXX DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB AUTO_INCREMENT=XXX DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-) ENGINE=InnoDB AUTO_INCREMENT=XXX DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-) ENGINE=InnoDB AUTO_INCREMENT=XXX DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
 /*M!999999\- enable the sandbox mode
 CREATE TABLE `analysis_jobs` (
 CREATE TABLE `analysis_results` (
 CREATE TABLE `api_keys` (
 CREATE TABLE `audio_jobs` (
 CREATE TABLE `password_reset_tokens` (
-CREATE TABLE `prompt_history` (
-CREATE TABLE `prompt_test_results` (
-CREATE TABLE `prompts` (
 CREATE TABLE `school_subjects` (
 CREATE TABLE `schools` (
 CREATE TABLE `system_settings` (
